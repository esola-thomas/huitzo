---
export interface NavSection {
  title: string;
  links: Array<{
    text: string;
    href: string;
    sublinks?: Array<{
      text: string;
      href: string;
    }>;
  }>;
}

export interface Props {
  sections: NavSection[];
  currentPath: string;
  audience: 'users' | 'developers';
  class?: string;
}

const { sections, currentPath, audience, class: className = '' } = Astro.props;

// Check if a link is active
const isActive = (href: string) => {
  return currentPath === href || currentPath.startsWith(href + '/');
};
---

<aside class={`docs-sidebar ${className}`} id="docs-sidebar">
  <div class="docs-sidebar-header">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">{audience === 'users' ? 'üìö' : 'üõ†Ô∏è'}</span>
      <h2 class="text-lg font-bold">
        {audience === 'users' ? 'User Guide' : 'Developer Guide'}
      </h2>
    </div>

    <!-- Audience Switcher -->
    <div class="audience-switcher mb-6">
      <a
        href="/docs/users"
        class={`switcher-btn ${audience === 'users' ? 'active' : ''}`}
      >
        Users
      </a>
      <a
        href="/docs/developers"
        class={`switcher-btn ${audience === 'developers' ? 'active' : ''}`}
      >
        Developers
      </a>
    </div>
  </div>

  <nav class="docs-sidebar-nav">
    {sections.map((section) => (
      <div class="docs-sidebar-section">
        <h3 class="docs-sidebar-title">{section.title}</h3>
        <ul class="docs-sidebar-list">
          {section.links.map((link) => (
            <li>
              <a
                href={link.href}
                class={`docs-sidebar-link ${isActive(link.href) ? 'active' : ''}`}
              >
                {link.text}
              </a>
              {link.sublinks && link.sublinks.length > 0 && (
                <ul class="docs-sidebar-sublist">
                  {link.sublinks.map((sublink) => (
                    <li>
                      <a
                        href={sublink.href}
                        class={`docs-sidebar-link sublink ${isActive(sublink.href) ? 'active' : ''}`}
                      >
                        {sublink.text}
                      </a>
                    </li>
                  ))}
                </ul>
              )}
            </li>
          ))}
        </ul>
      </div>
    ))}
  </nav>

  <!-- Back to Docs Home -->
  <div class="docs-sidebar-footer">
    <a href="/docs" class="docs-sidebar-link">
      ‚Üê Back to Docs Home
    </a>
  </div>
</aside>

<!-- Mobile Toggle Button -->
<button
  id="mobile-sidebar-toggle"
  class="mobile-sidebar-toggle"
  aria-label="Toggle sidebar"
  aria-controls="docs-sidebar"
  aria-expanded="false"
>
  <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
  </svg>
</button>

<style>
  .docs-sidebar {
    background: var(--aw-color-bg-secondary);
    border-right: 1px solid var(--aw-color-border);
    width: 280px;
    height: 100vh;
    position: sticky;
    top: 0;
    overflow-y: auto;
    padding: 2rem 1rem;
    flex-shrink: 0;
  }

  .docs-sidebar-header {
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--aw-color-border);
    margin-bottom: 1.5rem;
  }

  .audience-switcher {
    display: flex;
    gap: 0.5rem;
    background: var(--aw-color-bg-tertiary);
    padding: 0.25rem;
    border-radius: 6px;
  }

  .switcher-btn {
    flex: 1;
    padding: 0.5rem 1rem;
    text-align: center;
    font-size: 0.875rem;
    font-family: var(--aw-font-mono);
    color: var(--aw-color-text-muted);
    border-radius: 4px;
    transition: all 0.2s;
    text-decoration: none;
  }

  .switcher-btn:hover {
    color: var(--aw-color-text-default);
    background: var(--aw-color-bg-page);
  }

  .switcher-btn.active {
    background: var(--aw-color-primary);
    color: var(--aw-color-bg-page);
    font-weight: 600;
  }

  .docs-sidebar-nav {
    flex: 1;
  }

  .docs-sidebar-section {
    margin-bottom: 1.5rem;
  }

  .docs-sidebar-title {
    font-family: var(--aw-font-mono);
    color: var(--aw-color-primary);
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.5rem;
    font-weight: 600;
  }

  .docs-sidebar-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .docs-sidebar-sublist {
    list-style: none;
    padding-left: 1rem;
    margin-top: 0.25rem;
  }

  .docs-sidebar-link {
    display: block;
    padding: 0.5rem 1rem;
    color: var(--aw-color-text-default);
    border-left: 2px solid transparent;
    transition: all 0.2s;
    text-decoration: none;
    font-size: 0.875rem;
    border-radius: 4px;
    margin-bottom: 0.25rem;
  }

  .docs-sidebar-link.sublink {
    font-size: 0.8125rem;
    padding: 0.375rem 1rem;
    color: var(--aw-color-text-muted);
  }

  .docs-sidebar-link:hover {
    background: var(--aw-color-bg-tertiary);
    border-left-color: var(--aw-color-primary);
    color: var(--aw-color-primary);
  }

  .docs-sidebar-link.active {
    background: var(--aw-color-bg-tertiary);
    border-left-color: var(--aw-color-accent);
    color: var(--aw-color-accent);
    font-weight: 600;
  }

  .docs-sidebar-footer {
    padding-top: 1rem;
    border-top: 1px solid var(--aw-color-border);
    margin-top: 1rem;
  }

  .mobile-sidebar-toggle {
    display: none;
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 100;
    background: var(--aw-color-primary);
    color: var(--aw-color-bg-page);
    border: none;
    border-radius: 50%;
    width: 3.5rem;
    height: 3.5rem;
    box-shadow: 0 4px 12px rgba(0, 191, 255, 0.3);
    cursor: pointer;
    transition: all 0.3s;
  }

  .mobile-sidebar-toggle:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(0, 191, 255, 0.4);
  }

  /* Mobile Styles */
  @media (max-width: 768px) {
    .docs-sidebar {
      position: fixed;
      left: -280px;
      z-index: 50;
      transition: left 0.3s;
      height: 100vh;
      top: 0;
    }

    .docs-sidebar.open {
      left: 0;
    }

    .mobile-sidebar-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .mobile-sidebar-toggle[aria-expanded="true"] {
      background: var(--aw-color-accent-secondary);
    }
  }

  /* Scrollbar Styling */
  .docs-sidebar::-webkit-scrollbar {
    width: 6px;
  }

  .docs-sidebar::-webkit-scrollbar-track {
    background: var(--aw-color-bg-tertiary);
  }

  .docs-sidebar::-webkit-scrollbar-thumb {
    background: var(--aw-color-primary);
    border-radius: 3px;
  }

  .docs-sidebar::-webkit-scrollbar-thumb:hover {
    background: var(--aw-color-secondary);
  }
</style>

<script>
  // Mobile sidebar toggle
  document.addEventListener('DOMContentLoaded', () => {
    const sidebar = document.getElementById('docs-sidebar');
    const toggle = document.getElementById('mobile-sidebar-toggle');

    if (sidebar && toggle) {
      toggle.addEventListener('click', () => {
        const isOpen = sidebar.classList.contains('open');
        sidebar.classList.toggle('open');
        toggle.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
      });

      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', (e) => {
        if (window.innerWidth <= 768) {
          const target = e.target as HTMLElement;
          if (
            !sidebar.contains(target) &&
            !toggle.contains(target) &&
            sidebar.classList.contains('open')
          ) {
            sidebar.classList.remove('open');
            toggle.setAttribute('aria-expanded', 'false');
          }
        }
      });
    }

    // Scroll active link into view
    const activeLink = document.querySelector('.docs-sidebar-link.active');
    if (activeLink && sidebar) {
      activeLink.scrollIntoView({ block: 'center', behavior: 'smooth' });
    }
  });
</script>
