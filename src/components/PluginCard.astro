---
import type { Plugin } from '~/utils/plugins';
import { getCategoryColors, getStatusInfo } from '~/utils/plugins';

export interface Props {
  plugin: Plugin;
  showFullDescription?: boolean;
  class?: string;
}

const { plugin, showFullDescription = false, class: className = '' } = Astro.props;

const description = showFullDescription
  ? plugin.description
  : plugin.description.length > 120
    ? plugin.description.substring(0, 120) + '...'
    : plugin.description;

const categoryColors = getCategoryColors(plugin.category);
const statusInfo = getStatusInfo(plugin.status);
const categoryName = plugin.category.charAt(0).toUpperCase() + plugin.category.slice(1);

// Determine pricing display
const pricingText = plugin.pricing?.free?.available
  ? 'Free Tier Available'
  : plugin.pricing?.pro?.price
    ? plugin.pricing.pro.price
    : 'Pricing TBA';

// CTA link and text based on status
const ctaLink = plugin.status === 'active'
  ? `${import.meta.env.BASE_URL}plugins/${plugin.slug}`
  : plugin.status === 'coming-soon' || plugin.status === 'beta' || plugin.status === 'idea-phase'
    ? `${import.meta.env.BASE_URL}plugins/${plugin.slug}`
    : `${import.meta.env.BASE_URL}roadmap`;

const ctaText = plugin.status === 'active'
  ? 'Learn More →'
  : plugin.status === 'beta'
    ? 'Try Beta →'
    : plugin.status === 'idea-phase'
      ? 'View Concept →'
      : 'View Details →';
---

<div class={`card relative transition-all duration-300 ${categoryColors.hover} ${className}`}>
  <!-- Status and Category Badges -->
  <div class="absolute top-4 right-4 flex flex-col gap-2 items-end">
    <!-- Status Badge -->
    <span class={`text-xs px-2.5 py-1 rounded-full border ${statusInfo.badge} font-medium`}>
      {statusInfo.text}
    </span>

    <!-- Category Badge -->
    <span class={`text-xs px-2.5 py-1 rounded-full border ${categoryColors.badge} font-medium`}>
      {categoryName}
    </span>
  </div>

  <!-- Icon -->
  <div class="text-4xl mb-4">{plugin.icon}</div>

  <!-- Plugin Name and Version -->
  <h3 class="text-xl font-semibold mb-1 text-text-primary pr-32">{plugin.name}</h3>
  <p class="text-sm text-text-muted mb-3">v{plugin.version} • By {plugin.author}</p>

  <!-- Tagline -->
  <p class="text-sm font-medium text-huitzo-accent mb-2">{plugin.tagline}</p>

  <!-- Description -->
  <p class="text-text-secondary leading-relaxed mb-6">{description}</p>

  <!-- Footer -->
  <div class="flex flex-col gap-3 mt-auto">
    <!-- Pricing Info -->
    {plugin.pricing?.free?.available && (
      <div class="flex items-center gap-2">
        <span class="text-xs text-status-success">✓</span>
        <span class="text-xs text-status-success font-medium">{pricingText}</span>
      </div>
    )}

    <!-- CTA Button -->
    <a href={ctaLink} class={plugin.status === 'active' ? 'btn-primary text-sm w-full text-center' : 'btn-secondary text-sm w-full text-center'}>
      {ctaText}
    </a>
  </div>
</div>
